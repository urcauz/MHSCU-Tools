<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MHSCU Bot Dashboard</title>
<style>
  :root {
    --bg-color: #f5f7fa;
    --text-color: #333;
    --header-bg: #34495e;
    --card-bg: white;
    --btn-bg: #3498db;
    --btn-hover: #2980b9;
    --th-bg: #3498db;
    --th-color: white;
    --tbody-hover: #f1f6fb;
  }
  [data-theme="dark"] {
    --bg-color: #1e1e2f;
    --text-color: #e0e0e0;
    --header-bg: #2c3e50;
    --card-bg: #2c3e50;
    --btn-bg: #5dade2;
    --btn-hover: #3498db;
    --th-bg: #5dade2;
    --th-color: #fff;
    --tbody-hover: #34495e;
  }

  * { box-sizing: border-box; margin:0; padding:0; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; }
  body { background: var(--bg-color); color: var(--text-color); transition: all 0.3s ease; }
  header { background: var(--header-bg); color:white; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; }
  header h1 { font-weight:500; font-size:1.5rem; }
  main { padding:2rem; display:none; transition: all 0.3s ease; }

  section { background: var(--card-bg); padding:1.5rem; margin-bottom:1.5rem; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease; }
  h2 { font-size:1.2rem; margin-bottom:1rem; color: var(--text-color); }

  button { padding:0.5rem 1rem; border:none; border-radius:6px; cursor:pointer; background: var(--btn-bg); color:white; transition:0.2s; }
  button:hover { background: var(--btn-hover); }
  input, select, textarea { width:100%; padding:0.5rem; margin:0.3rem 0; border:1px solid #ccc; border-radius:6px; font-size:0.95rem; }
  textarea { resize:none; min-height:80px; }

  table { width:100%; border-collapse: collapse; margin-top:0.5rem; }
  th, td { padding:0.6rem 0.8rem; border:1px solid #e1e4e8; text-align:left; }
  th { background: var(--th-bg); color: var(--th-color); }
  tbody tr:hover { background: var(--tbody-hover); }

  #logsList { list-style:none; max-height:200px; overflow:auto; padding-left:0.5rem; }

  #passwordPrompt { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.65); display:flex; align-items:center; justify-content:center; }
  #passwordPrompt div { background:white; padding:2rem; border-radius:10px; width:300px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.2);}
  #passwordPrompt input { margin-bottom:1rem; }

  /* Theme Toggle Button */
  #themeToggle { padding:0.3rem 0.6rem; font-size:0.9rem; border-radius:6px; margin-left:1rem; background:#ecf0f1; color:#2c3e50; border:none; cursor:pointer; }
  [data-theme="dark"] #themeToggle { background:#34495e; color:#fff; }
</style>
</head>
<body data-theme="light">

<!-- Password Overlay -->
<div id="passwordPrompt">
  <div>
    <h2>Dashboard Login</h2>
    <input type="password" id="dashboardPassword" placeholder="Enter password">
    <button onclick="checkPassword()">Login</button>
    <p id="passMsg" style="color:red; margin-top:0.5rem;"></p>
  </div>
</div>

<header>
  <h1>MHSCU Bot Dashboard</h1>
  <div>
    <span id="botStatusHeader">Status: Loading...</span>
    <button id="themeToggle" onclick="toggleTheme()">🌙 Dark Mode</button>
  </div>
</header>

<main id="dashboard">

  <!-- Bot Overview -->
  <section>
    <h2>Bot Overview</h2>
    <p>Uptime: <span id="botUptime">0s</span></p>
    <p>Total Messages: <span id="totalMessages">0</span></p>
    <p>Muted Users: <span id="mutedUsers">0</span></p>
  </section>

  <!-- Leaderboard -->
  <section>
    <h2>Leaderboard</h2>
    <table>
      <thead>
        <tr><th>User ID</th><th>Messages</th></tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>
    <div style="margin-top:0.5rem;">
      <button onclick="resetLeaderboard()">Reset Leaderboard</button>
      <button onclick="sendTestLeaderboard()">Send Test Leaderboard</button>
    </div>
  </section>

  <!-- Announcements -->
  <section>
    <h2>Send Announcement</h2>
    <select id="announcementChannel">
      <option value="leaderboard">Leaderboard Channel</option>
      <option value="suggestions">Suggestions Channel</option>
      <option value="logs">Logs Channel</option>
    </select>
    <textarea id="announcementMessage" placeholder="Type your announcement here..."></textarea>
    <button onclick="sendAnnouncement()">Send</button>
  </section>

  <!-- Logs -->
  <section>
    <h2>Logs</h2>
    <ul id="logsList"></ul>
    <button onclick="loadLogs()">Refresh Logs</button>
  </section>

  <!-- Moderation -->
  <section>
    <h2>User Moderation</h2>
    <input type="text" id="userSearch" placeholder="Search user by ID or name" oninput="filterUsers()">
    <table>
      <thead>
        <tr><th>User ID</th><th>Actions</th></tr>
      </thead>
      <tbody id="userListBody"></tbody>
    </table>
  </section>

</main>

<script>
let AUTH_HEADER = null;

function toggleTheme(){
  const body = document.body;
  const toggle = document.getElementById('themeToggle');
  if(body.getAttribute('data-theme') === 'light'){
    body.setAttribute('data-theme','dark');
    toggle.textContent = '☀️ Light Mode';
  } else {
    body.setAttribute('data-theme','light');
    toggle.textContent = '🌙 Dark Mode';
  }
}

function checkPassword() {
  const passInput = document.getElementById('dashboardPassword').value;
  if (!passInput) return;
  AUTH_HEADER = "Bearer " + passInput;
  document.getElementById('passwordPrompt').style.display = "none";
  document.getElementById('dashboard').style.display = "block";
  initDashboard();
}

async function fetchAPI(endpoint, options={}) {
  if (!options.headers) options.headers = {};
  if (AUTH_HEADER) options.headers['Authorization'] = AUTH_HEADER;
  const res = await fetch(endpoint, options);
  if (res.status === 401) {
    alert("Incorrect password!");
    location.reload();
    return;
  }
  return res.json();
}

// Bot Status
async function updateStatus() {
  const status = await fetchAPI('/api/status');
  if (!status) return;
  document.getElementById('botStatusHeader').textContent = status.online ? 'Status: Online ✅' : 'Status: Offline ❌';
  document.getElementById('botUptime').textContent = `${Math.floor(status.uptime/60)}m ${Math.floor(status.uptime%60)}s`;
  document.getElementById('totalMessages').textContent = status.messages;
  document.getElementById('mutedUsers').textContent = status.mutedUsers;
}

// Leaderboard
async function loadLeaderboard() {
  const lb = await fetchAPI('/api/leaderboard');
  if (!lb) return;
  const tbody = document.getElementById('leaderboardBody');
  tbody.innerHTML = '';
  Object.entries(lb).sort((a,b)=>b[1]-a[1]).forEach(([id,count])=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${id}</td><td>${count}</td>`;
    tbody.appendChild(tr);
  });
}

async function resetLeaderboard() {
  await fetchAPI('/api/reset-leaderboard',{ method:'POST' });
  loadLeaderboard();
}

async function sendTestLeaderboard() {
  await fetchAPI('/api/test-leaderboard',{ method:'POST' });
  alert("Test leaderboard sent!");
}

// Announcements
async function sendAnnouncement() {
  const channel = document.getElementById('announcementChannel').value;
  const message = document.getElementById('announcementMessage').value;
  if (!message) return alert("Message cannot be empty!");
  await fetchAPI('/api/announcement',{
    method:'POST',
    headers:{ 'Content-Type':'application/json'},
    body: JSON.stringify({channel,message})
  });
  alert("Announcement sent!");
  document.getElementById('announcementMessage').value = '';
}

// Logs
async function loadLogs() {
  const logs = await fetchAPI('/api/logs');
  const ul = document.getElementById('logsList');
  ul.innerHTML = '';
  logs.forEach(l=>{
    const li = document.createElement('li');
    li.textContent = `[${new Date(l.time).toLocaleTimeString()}] ${l.message}`;
    ul.appendChild(li);
  });
}

// Moderation Users
let allUsers = [];

async function loadUsers() {
  const guildStatus = await fetchAPI('/api/status');
  if(!guildStatus) return;
  allUsers = guildStatus.users || [];
  renderUsers(allUsers);
}

function renderUsers(users){
  const tbody = document.getElementById('userListBody');
  tbody.innerHTML = '';
  users.forEach(u=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.id}</td>
    <td>
      <button onclick="moderate('${u.id}','mute')">Mute</button>
      <button onclick="moderate('${u.id}','unmute')">Unmute</button>
      <button onclick="moderate('${u.id}','kick')">Kick</button>
      <button onclick="moderate('${u.id}','ban')">Ban</button>
      <button onclick="moderate('${u.id}','timeout')">Timeout</button>
    </td>`;
    tbody.appendChild(tr);
  });
}

function filterUsers() {
  const query = document.getElementById('userSearch').value.toLowerCase();
  renderUsers(allUsers.filter(u=> u.name.toLowerCase().includes(query) || u.id.toString().includes(query)));
}

async function moderate(userId, action){
  const reason = prompt(`Reason for ${action} on ${userId}?`) || 'No reason';
  let duration = null;
  if(action==='timeout') duration = prompt("Timeout duration in minutes", "10");
  await fetchAPI('/api/moderate',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({userId, action, reason, duration})
  });
  alert(`${action} applied to ${userId}`);
}

// Initialize Dashboard
function initDashboard(){
  updateStatus();
  loadLeaderboard();
  loadLogs();
  loadUsers();
  setInterval(updateStatus,5000);
  setInterval(loadLeaderboard,10000);
  setInterval(loadLogs,10000);
}
</script>
</body>
</html>
